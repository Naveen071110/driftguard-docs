# Run Check

Compare an incoming schema against an existing contract and return a status (`OK`, `WARNING`, `BREAKING`) and a diff.

---

## Endpoint

```http
POST /v1/checks
Host: api.driftguard.dev
```

---

## Request

```json
{
  "contract_id": "ctr_01HX7KMQZP",
  "incoming_schema": [
    { "name": "user_id",    "type": "string" },
    { "name": "created_at", "type": "string" }
  ],
  "source": "ci"
}
```

| Field                    | Type     | Required | Description                                          |
| ------------------------ | -------- | -------- | ---------------------------------------------------- |
| `contract_id`            | `string` | ✅        | ID of the contract to check against                  |
| `incoming_schema`        | `array`  | ✅        | Columns from the actual data source                  |
| `incoming_schema[].name` | `string` | ✅        | Column name                                          |
| `incoming_schema[].type` | `string` | ✅        | Detected type                                        |
| `source`                 | `string` | ❌        | Tag e.g. `ci`, `pipeline`, `manual`                  |

---

## Response

```json
{
  "check_id": "chk_01HX7KN123",
  "status": "BREAKING",
  "summary": {
    "breaking": 2,
    "warning": 0,
    "ok": 1
  },
  "diff": [
    {
      "column": "email",
      "change": "REMOVED",
      "severity": "BREAKING",
      "message": "Required column 'email' is missing from incoming schema."
    },
    {
      "column": "created_at",
      "change": "TYPE_CHANGED",
      "from_type": "timestamp",
      "to_type": "string",
      "severity": "BREAKING",
      "message": "Narrowing type change. Downstream casts will fail."
    }
  ],
  "evaluated_at": "2026-02-27T18:00:14Z",
  "credits_used": 1
}
```

---

## Errors

| Code  | Description             |
| ----- | ----------------------- |
| `400` | Invalid schema format   |
| `401` | Unauthorized            |
| `403` | Out of credits          |
| `404` | Contract not found      |
| `429` | Rate limit exceeded     |
